# SmartHaus Notebook Governance Standard (Canonical)

This is the canonical SmartHaus governance standard to copy into any repository that must enforce notebook-first runtime governance.

## Policy ID

- `SH-GOV-CONTRACT-V1`

## Hard Rule

- Runtime-authoritative code must be notebook-governed and traceable.
- Support/tooling code may be exempt only by explicit boundary classification.
- No silent exceptions.
- Fail closed on missing mapping, drift, or unclassified runtime files.

## Required Artifacts Per Repository

Every adopting repository must define:

1. `docs/architecture/MA_EXTRACTION_BOUNDARY.md`
   - Human-readable classification of runtime-authoritative vs support/tooling Python code.

2. `configs/ma/governance_scope.yaml`
   - Machine-readable file-scope patterns:
     - `runtime_authoritative_patterns`
     - `support_tooling_patterns`

3. `configs/ma_module_registry.yaml`
   - Registry for runtime-authoritative modules with required fields:
     - `module_id`
     - `runtime_path`
     - `notebook_path`
     - `scorecard_path`
     - `ma_phase`
     - `lemma_id`
     - `invariant_id`

4. Notebook sources under `notebooks/`
   - Runtime-authoritative modules must originate in notebooks.
   - Notebook metadata must include lemma/invariant references and seed-lock metadata.

5. Per-module scorecards under `artifacts/scorecards/`
   - Deterministic validation and extraction provenance.

6. Generated traceability index:
   - `docs/CODE_TRACEABILITY_INDEX.md`
   - Generated by script, not hand-maintained.

7. Governance verifier:
   - `scripts/ma/verify_notebook_governance.py`
   - Enforces scope coverage, registry correctness, and extraction parity.

## Fail-Closed Enforcement Contract

Governance verification must fail when any of the following is true:

- A runtime-authoritative Python file has no registry mapping.
- A runtime-authoritative module is out of sync with notebook extraction output.
- A Python file is unclassified by governance scope.
- Registry entries exist for files not classified runtime-authoritative.
- Runtime-authoritative files are excluded by ad-hoc exceptions.

## Standard MA Gate Integration

`make ma-validate` (or equivalent) should include:

1. lint
2. unit tests
3. governance verify (fast precheck)
4. notebook pipeline
5. governance verify (full parity check)

Gate order must fail closed on first hard error.

## Runtime/MCP Enforcement Layer

CI is primary enforcement. Runtime (MCP server/packs) should additionally enforce policy for privileged actions:

- block extraction/deployment-sensitive actions when governance is non-green
- emit structured policy events for allow/deny decisions

## Org-Wide Repeatability Rule

Repositories may differ architecturally, but they must preserve equivalent guarantees:

- explicit boundary
- explicit scope file
- explicit module registry
- deterministic notebook extraction parity
- generated traceability artifact
- fail-closed governance verification in CI

If these guarantees are absent, repository governance is non-compliant with `SH-GOV-CONTRACT-V1`.
